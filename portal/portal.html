<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>山西省矿山地质环境和资源数据应用系统</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.8/esri/css/main.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="https://js.arcgis.com/4.8/"></script>
    <script src="js/jquery.js"></script>
</head>


<body>
<div class="container">
    <!--标题-->
    <div class="header">
        山西省矿山地质环境和资源数据应用系统
    </div>

    <!--侧栏菜单（左边）-->
    <div class="sideBar">
        <ul class="gisFunc">

            <li class="gis">信息查询</li>
            <li class="gis">基础统计</li>

            <li class="gis">地理分析
                <ul class="tools">
                    <li class="analyse">变化分析</li>
                    <li class="analyse">核密度分析</li>
                </ul>
            </li>
            <li class="gis">成果输出
                <ul class="tools">
                    <li class="analyse">地图输出</li>
                    <li class="analyse">统计表输出</li>
                </ul>
            </li>

        </ul>

    </div>

    <!--图层控制（浮动）-->
    <div class="lyrControl">

    </div>

    <!--地图控件（右上角）-->
    <div class="mapControl">
        <div class="normalControl">

        </div>
        <div class="tabMap">

        </div>
    </div>

    <!--地图容器（加载底图）-->
    <div id="viewDiv">

    </div>
</div>


    <script>


        require([
            "esri/tasks/Locator",
            "esri/widgets/CoordinateConversion",
            "esri/widgets/Compass",
            "esri/widgets/ScaleBar",
            "esri/Map",
            "esri/widgets/LayerList",
            "esri/views/MapView",
            "esri/layers/FeatureLayer",

            "dojo/domReady!"
        ], function(               //参数与调用对应
            Locator,
            CoordinateConversion,
            Compass,
            ScaleBar,
            Map,
            LayerList,
            MapView,
            FeatureLayer
        ){
            var map = new Map({
                basemap: "topo"
            });

            var view = new MapView({
                container: "viewDiv",  // Reference to the scene div created in step 5
                map: map,  // Reference to the map object created before the scene
                zoom: 7,
                center: [112.537674, 37.871594]  // 112.537674,37.871594
            });

            //-----------popup模板------------
            var template ={
                title:"矿山崩塌信息:",
                content:[{
                    type:"fields",
                    fieldInfos:[{
                        fieldName:"CREATEDATE",
                        label:"采集日期",
                        visible:true
                    },{
                        fieldName: "SLOPE_TYPE",
                        label: "土质类型",
                        visible: true,
                        // format: {
                        //     digitSeparator: true,
                        //     places: 0
                        // }

                    },{
                        fieldName:"COLLAPSE_T",
                        label:"崩塌类型",
                        visible:true
                    },{
                        fieldName:"MEMO",
                        label:"崩塌描述",
                        visible:true
                    }]
                }]
            };

            // var chinaLayer = new FeatureLayer({
            //     url: "https://localhost:6443/arcgis/rest/services/test1/china/MapServer"
            // });
            // map.add(chinaLayer);

            var railLayer = new FeatureLayer({
                url: "https://localhost:6443/arcgis/rest/services/test1/railway/MapServer"
            });
            map.add(railLayer);

            var pointLayer = new FeatureLayer({
                url: "https://localhost:6443/arcgis/rest/services/test1/point01/MapServer",
                outFields: ["*"],
                popupTemplate: template
            });
            map.add(pointLayer);

            view.when(function() {
                var layerList = new LayerList({
                    view: view
                });
                view.ui.add(layerList, "top-right");
            });



            //-----------位置坐标--------------
            var ccWidget = new CoordinateConversion({
                view: view
            });
            view.ui.add(ccWidget, "bottom-right");

            //------------比例尺--------------
            var scaleBar = new ScaleBar({
                view: view,
                unit: "metric"// The scale bar displays both metric and non-metric units.
                //style:"ruler"
            });
            view.ui.add(scaleBar, "bottom-right");

            view.ui.move("zoom", "top-right");
            var compassWidget = new Compass({
                view: view
            });
            view.ui.add(compassWidget, "top-right");
            view.ui.add('scale', "top-right");


        });

    </script>
    <script>
        $(function () {
            $('.gis').on('click', function () {
                if ($(this).children('.tools').is(':visible')) {
                    $(this).children('.tools').slideUp();
                   //测试 console.log($('.gis'));

                } else {
                    $(this).children('.tools').slideDown();
                }
            })
        })
    </script>
</body>
</html>